@*
    Routes.razor - Central router component for QDeskPro

    ARCHITECTURE (Pure Blazor Server):
    - MudBlazor providers are at the top of this component for circuit sharing
    - All interactive components share the same Blazor circuit
    - Account pages use [ExcludeFromInteractiveRouting] for SSR-only auth
    - Uses AuthorizeRouteView for role-based access control
*@

@using MudBlazor

@* MudBlazor Theme Provider with theme state *@
<MudThemeProvider Theme="_theme" @bind-IsDarkMode="@_isDarkMode" />

@* MudBlazor UI Providers - required for popups, dialogs, and snackbars *@
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

@* Main Router with Theme Cascading and Authentication State *@
<CascadingAuthenticationState>
    <CascadingValue Value="_isDarkMode" Name="IsDarkMode">
        <CascadingValue Value="this" Name="ThemeService">
            <Router AppAssembly="typeof(Program).Assembly">
                <Found Context="routeData">
                    <AuthorizeRouteView RouteData="routeData" DefaultLayout="typeof(Layout.MainLayout)">
                        <NotAuthorized>
                            <RedirectToLogin />
                        </NotAuthorized>
                        <Authorizing>
                            <div class="auth-loading-container">
                                <div class="auth-loading-content">
                                    <div class="auth-logo-wrapper">
                                        <div class="auth-logo-pulse"></div>
                                        <div class="auth-logo">
                                            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M24 4L8 14v20l16 10 16-10V14L24 4z" fill="url(#grad1)" opacity="0.9"/>
                                                <path d="M24 4L8 14l16 10 16-10L24 4z" fill="url(#grad2)"/>
                                                <path d="M24 24v20l16-10V14L24 24z" fill="#1565C0" opacity="0.7"/>
                                                <path d="M24 24v20L8 34V14l16 10z" fill="#1976D2" opacity="0.5"/>
                                                <defs>
                                                    <linearGradient id="grad1" x1="8" y1="24" x2="40" y2="24">
                                                        <stop stop-color="#1976D2"/>
                                                        <stop offset="1" stop-color="#42A5F5"/>
                                                    </linearGradient>
                                                    <linearGradient id="grad2" x1="8" y1="9" x2="40" y2="9">
                                                        <stop stop-color="#42A5F5"/>
                                                        <stop offset="1" stop-color="#90CAF9"/>
                                                    </linearGradient>
                                                </defs>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="auth-loading-text">
                                        <span class="auth-brand">QDeskPro</span>
                                        <span class="auth-status">Authorizing</span>
                                    </div>
                                    <div class="auth-loading-dots">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                    <div class="auth-loading-bar">
                                        <div class="auth-loading-bar-progress"></div>
                                    </div>
                                </div>
                            </div>
                        </Authorizing>
                    </AuthorizeRouteView>
                    <FocusOnNavigate RouteData="routeData" Selector="h1" />
                </Found>
                <NotFound>
                    <LayoutView Layout="typeof(Layout.MainLayout)">
                        <QDeskPro.Components.Pages.NotFound />
                    </LayoutView>
                </NotFound>
            </Router>
        </CascadingValue>
    </CascadingValue>
</CascadingAuthenticationState>

@code {
    private bool _isDarkMode = false;

    private MudTheme _theme = new MudTheme
    {
        PaletteLight = new PaletteLight
        {
            Primary = "#1976D2",           // Deep Blue - primary actions
            Secondary = "#424242",          // Dark Grey - secondary elements
            Tertiary = "#4CAF50",           // Green - success states
            Info = "#2196F3",               // Light Blue - informational
            Success = "#4CAF50",            // Green - success
            Warning = "#FF9800",            // Orange - warnings
            Error = "#F44336",              // Red - errors, unpaid items
            Background = "#FAFAFA",         // Light grey background
            Surface = "#FFFFFF",            // White cards/surfaces
            AppbarBackground = "#1976D2",   // Primary blue appbar
            AppbarText = "#FFFFFF",
            DrawerBackground = "#FFFFFF",
            DrawerText = "#424242",
            DrawerIcon = "#757575",
            TextPrimary = "#1a1a2e",
            TextSecondary = "#64748b",
        },
        PaletteDark = new PaletteDark
        {
            Primary = "#90CAF9",            // Light Blue for dark mode
            Secondary = "#BDBDBD",
            Tertiary = "#81C784",
            Background = "#121212",
            Surface = "#1E1E1E",
            AppbarBackground = "#1E1E1E",
            TextPrimary = "#f1f5f9",
            TextSecondary = "#94a3b8",
        },
        LayoutProperties = new LayoutProperties
        {
            DefaultBorderRadius = "8px",
            AppbarHeight = "64px",
            DrawerWidthLeft = "280px"
        }
    };

    public void ToggleTheme()
    {
        _isDarkMode = !_isDarkMode;
    }
}
